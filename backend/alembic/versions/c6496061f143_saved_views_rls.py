"""saved_views_rls

Revision ID: c6496061f143
Revises: c0ef6cda2b49
Create Date: 2025-12-27 14:02:12.338513

"""

from collections.abc import Sequence

from alembic_utils.pg_policy import PGPolicy

from alembic import op

# revision identifiers, used by Alembic.
revision: str = "c6496061f143"
down_revision: str | Sequence[str] | None = "c0ef6cda2b49"
branch_labels: str | Sequence[str] | None = None
depends_on: str | Sequence[str] | None = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.enable_rls("public", "saved_views")
    public_saved_views_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.saved_views",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            NULLIF(current_setting('app.is_system_mode', true), '')::boolean IS TRUE\n                            OR (NULLIF(current_setting('app.team_id', true), '') IS NOT NULL\n                                AND team_id = NULLIF(current_setting('app.team_id', true), '')::int)\n                        )",
    )
    op.create_entity(public_saved_views_team_scope_policy)

    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    public_saved_views_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.saved_views",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            NULLIF(current_setting('app.is_system_mode', true), '')::boolean IS TRUE\n                            OR (NULLIF(current_setting('app.team_id', true), '') IS NOT NULL\n                                AND team_id = NULLIF(current_setting('app.team_id', true), '')::int)\n                        )",
    )
    op.drop_entity(public_saved_views_team_scope_policy)

    op.disable_rls("public", "saved_views")
    # ### end Alembic commands ###
