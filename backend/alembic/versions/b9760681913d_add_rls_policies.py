"""add rls policies

Revision ID: b9760681913d
Revises: 62374ba3d425
Create Date: 2025-11-17 17:55:17.922146

"""

from typing import Sequence, Union

import sqlalchemy as sa
from alembic_utils.pg_policy import PGPolicy
from sqlalchemy import text as sql_text

from alembic import op

# revision identifiers, used by Alembic.
revision: str = "b9760681913d"
down_revision: Union[str, Sequence[str], None] = "62374ba3d425"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.enable_rls("public", "brand_contacts")
    op.enable_rls("public", "brands")
    op.enable_rls("public", "campaign_contracts")
    op.enable_rls("public", "campaigns")
    op.enable_rls("public", "dashboards")
    op.enable_rls("public", "deliverable_media")
    op.enable_rls("public", "deliverables")
    op.enable_rls("public", "documents")
    op.enable_rls("public", "email_messages")
    op.enable_rls("public", "events")
    op.enable_rls("public", "invoices")
    op.enable_rls("public", "media")
    op.enable_rls("public", "messages")
    op.enable_rls("public", "payment_blocks")
    op.enable_rls("public", "roster")
    op.enable_rls("public", "threads")
    public_threads_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.threads",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_threads_team_scope_policy)

    public_messages_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.messages",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.create_entity(public_messages_dual_scope_policy)

    public_events_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.events",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_events_team_scope_policy)

    public_invoices_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.invoices",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.create_entity(public_invoices_dual_scope_policy)

    public_roster_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.roster",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_roster_team_scope_policy)

    public_email_messages_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.email_messages",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_email_messages_team_scope_policy)

    public_dashboards_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.dashboards",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_dashboards_team_scope_policy)

    public_deliverables_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.deliverables",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.create_entity(public_deliverables_dual_scope_policy)

    public_deliverable_media_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.deliverable_media",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.create_entity(public_deliverable_media_dual_scope_policy)

    public_documents_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.documents",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.create_entity(public_documents_dual_scope_policy)

    public_campaigns_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.campaigns",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_campaigns_team_scope_policy)

    public_payment_blocks_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.payment_blocks",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_payment_blocks_team_scope_policy)

    public_campaign_contracts_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.campaign_contracts",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_campaign_contracts_team_scope_policy)

    public_media_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.media",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.create_entity(public_media_dual_scope_policy)

    public_brand_contacts_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.brand_contacts",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_brand_contacts_team_scope_policy)

    public_brands_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.brands",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.create_entity(public_brands_team_scope_policy)

    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    public_brands_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.brands",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_brands_team_scope_policy)

    public_brand_contacts_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.brand_contacts",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_brand_contacts_team_scope_policy)

    public_media_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.media",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.drop_entity(public_media_dual_scope_policy)

    public_campaign_contracts_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.campaign_contracts",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_campaign_contracts_team_scope_policy)

    public_payment_blocks_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.payment_blocks",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_payment_blocks_team_scope_policy)

    public_campaigns_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.campaigns",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_campaigns_team_scope_policy)

    public_documents_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.documents",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.drop_entity(public_documents_dual_scope_policy)

    public_deliverable_media_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.deliverable_media",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.drop_entity(public_deliverable_media_dual_scope_policy)

    public_deliverables_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.deliverables",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.drop_entity(public_deliverables_dual_scope_policy)

    public_dashboards_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.dashboards",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_dashboards_team_scope_policy)

    public_email_messages_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.email_messages",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_email_messages_team_scope_policy)

    public_roster_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.roster",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_roster_team_scope_policy)

    public_invoices_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.invoices",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.drop_entity(public_invoices_dual_scope_policy)

    public_events_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.events",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_events_team_scope_policy)

    public_messages_dual_scope_policy = PGPolicy(
        schema="public",
        signature="dual_scope_policy",
        on_entity="public.messages",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR (current_setting('app.campaign_id', true) IS NOT NULL\n                                AND campaign_id = current_setting('app.campaign_id', true)::int)\n                            OR (current_setting('app.is_system_mode', true)::boolean IS TRUE)\n                        )",
    )
    op.drop_entity(public_messages_dual_scope_policy)

    public_threads_team_scope_policy = PGPolicy(
        schema="public",
        signature="team_scope_policy",
        on_entity="public.threads",
        definition="AS PERMISSIVE\n                        FOR ALL\n                        USING (\n                            (current_setting('app.team_id', true) IS NOT NULL\n                             AND team_id = current_setting('app.team_id', true)::int)\n                            OR current_setting('app.is_system_mode', true)::boolean IS TRUE\n                        )",
    )
    op.drop_entity(public_threads_team_scope_policy)

    op.disable_rls("public", "threads")
    op.disable_rls("public", "roster")
    op.disable_rls("public", "payment_blocks")
    op.disable_rls("public", "messages")
    op.disable_rls("public", "media")
    op.disable_rls("public", "invoices")
    op.disable_rls("public", "events")
    op.disable_rls("public", "email_messages")
    op.disable_rls("public", "documents")
    op.disable_rls("public", "deliverables")
    op.disable_rls("public", "deliverable_media")
    op.disable_rls("public", "dashboards")
    op.disable_rls("public", "campaigns")
    op.disable_rls("public", "campaign_contracts")
    op.disable_rls("public", "brands")
    op.disable_rls("public", "brand_contacts")
    # ### end Alembic commands ###
